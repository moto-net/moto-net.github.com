---
title: test10の解説(OBJgroup)
layout: post
category : test10
tags : [opengl, test10, oyas]
published: false
---

オブジェクトグループの解説
==================

今回は、**<font color="#ff0000">OBJgroup(オブジェクトグループ)</font>**について解説します。名前は適当です。
これはボックスをたくさん作ってしまうとそれぞれに対しての
処理とかが大変になってしまうので、
いくらかづつまとめて管理しようということで、作られました。
どせいと床以外はこれで管理しています。

ソース(<font color="#0000ff">Stage/stage1.cpp</font>)をみてみると、
`OBJgroup1,OBJgroup2,OBJgroup3,・・・`
と最後の数字だけ違う名前のクラスが多く見つかります。
全部外からは同じ扱いをします。
なのでほんとは基底クラスから派生させてたり、
配列で管理してたほうがよかったんでしょうが、
もうなんでこんな実装のしかたしたんだろ。。
おそらく、当時、時間なくてとりあえずこうしたんだと思います。

それぞれのオブジェクトグループの中身をみると、
**`void Disp_Colli()`**という関数と**`コンストラクタ`**が見つかりますね。
どのオブジェクトグループを見ても、同じのがあります。

以下、それぞれの関数の説明です。


コンストラクタ
---------------
これはクラスが作成された時に呼ばれます。
ここではおおきく二つのことをやっています。 

	1. ボックスの初期配置
	2. バウンディングスフィアの計算
	
**ボックスの初期配置**はそのまま、だらだらと位置を入力してあるだけです。
**バウンディングスフィアの計算**では、ボックスの配置を基に
<font color="#00ff00">オブジェクトグループを囲む球の半径</font>を求めます。
これは当たり判定の高速化のためにおこないます。
当たり判定をするとき、球の内側に入っているかまず判定して、
入っていなかったら、処理を飛ばします。

Disp_Colli()
----------------
この関数は1フレーム毎に呼ばれます。
ここでやることは、以下の３つです。

	1. ボックスの配置更新
	2. ボックスのレンダリング
	3. 当たり判定

**ボックスの配置更新**では、動きのあるステージを実現します。
好きなようにボックスを動かします。
**当たり判定**は、<font color="#ff00ff">boxクラス</font>でやってくれるので、
バウンディングスフィア内かどうかを判定して、
`box.NormalForce()`へ任せます。

<br>

ざっとこんな感じですね。
これを真似して新しいオブジェクトグループを作成すれば、
ステージを拡大させることができます。
ここはこのプログラムの中で一番目に見えて楽しいとこです。
興味があったらステージを拡大してみてください。
いちど自分で作ってみると楽しいと思いますよ。


